apiVersion: "acid.zalan.do/v1"
kind: postgresql
metadata:
  name: khoj-db
  namespace: cnpg-zalando
spec:
  teamId: "khoj"
  numberOfInstances: 1
  users:
    postgres:
      - superuser
      - createdb
    khoj:
      - superuser
      - createdb
      passwordSecretName: khoj-secret
      passwordSecretKey: POSTGRES_PASSWORD
  volume:
    size: 10Gi
    storageClass: local-storage
  postgresql:
    version: "15"
  databases:
    khoj: khoj
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  enableMasterLoadBalancer: true
  allowedSourceRanges:
    - 10.0.0.0/8
    - 172.16.0.0/12
    - 192.168.0.0/16
  preparedDatabases:
    khoj: {}
  env:
    - name: POSTGRES_PASSWORD
      valueFrom:
        secretKeyRef:
          name: postgres-admin-secret
          key: superuser-password 
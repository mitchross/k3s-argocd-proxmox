apiVersion: v1
kind: ConfigMap
metadata:
  name: ai-orchestrator-config
  namespace: ai-orchestrator
data:
  config.yaml: |
    pollingIntervalSeconds: 60
    ollama:
      deployment: ollama
      namespace: ollama
      dualGpuAnnotation: ai.orchestrator/gpu-mode
      singleValue: "single"
      dualValue: "dual"
      idleGpuUtilPercent: 10
      idleRequestRate: 0.02   # req/sec averaged
      idleMinutes: 10
      scaleDownToOneCooldownMinutes: 5
      scaleUpToTwoCooldownMinutes: 2
    comfyui:
      deployment: comfyui
      namespace: comfyui
      activityRequestRate: 0.02
      wakeMinutes: 2
      cooldownMinutes: 5
    prometheus:
      url: http://kube-prometheus-stack-prometheus.prometheus-stack:9090
      queries:
        ollamaRequestRate: |
          sum(rate(http_server_requests_total{namespace="ollama",pod=~"ollama-.*",method!="OPTIONS"}[5m]))
        comfyuiRequestRate: |
          sum(rate(http_server_requests_total{namespace="comfyui",pod=~"comfyui-.*",method!="OPTIONS"}[5m]))
        gpuUtil: |
          avg(DCGM_FI_DEV_GPU_UTIL{kubernetes_node="%NODE_NAME%"})

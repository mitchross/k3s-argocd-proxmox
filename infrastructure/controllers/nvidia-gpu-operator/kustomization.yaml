apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: gpu-operator
resources:
  - namespace.yaml
  - time-slicing-config.yaml
helmCharts:
  - name: gpu-operator
    repo: https://helm.ngc.nvidia.com/nvidia
    version: v25.3.0
    releaseName: gpu-operator
    namespace: gpu-operator
    includeCRDs: true
    valuesInline:
      operator:
        defaultRuntime: containerd
      nfd:
        enabled: false
      driver:
        enabled: false
      toolkit:
        enabled: false
      devicePlugin:
        enabled: true
        nodeSelector:
          feature.node.kubernetes.io/pci-0300_10de.present: "true"
        tolerations:
          - key: nvidia.com/gpu
            operator: Exists
            effect: NoSchedule
          - key: "gpu"
            operator: Equal
            value: "true"
            effect: NoSchedule
          - key: node-role.kubernetes.io/master
            operator: Exists
            effect: NoSchedule
          - key: node-role.kubernetes.io/control-plane
            operator: Exists
            effect: NoSchedule
        config:
          name: time-slicing-config
          default: config.yaml
      migManager:
        enabled: false
      gfd:
        enabled: true
        nodeSelector:
          feature.node.kubernetes.io/pci-0300_10de.present: "true"
        tolerations:
          - key: nvidia.com/gpu
            operator: Exists
            effect: NoSchedule
          - key: "gpu"
            operator: Equal
            value: "true"
            effect: NoSchedule
          - key: node-role.kubernetes.io/master
            operator: Exists
            effect: NoSchedule
          - key: node-role.kubernetes.io/control-plane
            operator: Exists
            effect: NoSchedule
      dcgmExporter:
        enabled: true
        nodeSelector:
          feature.node.kubernetes.io/pci-0300_10de.present: "true"
        tolerations:
          - key: nvidia.com/gpu
            operator: Exists
            effect: NoSchedule
          - key: "gpu"
            operator: Equal
            value: "true"
            effect: NoSchedule
          - key: node-role.kubernetes.io/master
            operator: Exists
            effect: NoSchedule
          - key: node-role.kubernetes.io/control-plane
            operator: Exists
            effect: NoSchedule
      validator:
        driver:
          env:
            - name: DISABLE_DEV_CHAR_SYMLINK_CREATION
              value: "true"
        nodeSelector:
          feature.node.kubernetes.io/pci-0300_10de.present: "true"
        tolerations:
          - key: nvidia.com/gpu
            operator: Exists
            effect: NoSchedule
          - key: "gpu"
            operator: Equal
            value: "true"
            effect: NoSchedule
          - key: node-role.kubernetes.io/master
            operator: Exists
            effect: NoSchedule
          - key: node-role.kubernetes.io/control-plane
            operator: Exists
            effect: NoSchedule

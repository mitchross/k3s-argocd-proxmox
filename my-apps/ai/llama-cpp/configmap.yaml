apiVersion: v1
kind: ConfigMap
metadata:
  name: llama-swap-config
  namespace: llama-cpp
data:
  config.yaml: |
    # Simplified Qwen3-Coder configs
    models:
      # Default dual-GPU fast balanced
      qwen3-coder-ud-q4-128k-dual:
        cmd: "/app/llama-server \
          -m /models/Qwen3-Coder-30B-A3B-Instruct-UD-Q4_K_XL.gguf \
          -c 131072 -ngl 99 --split-mode layer --tensor-split 1,1 \
          --rope-scaling yarn --rope-scale 4 \
          --flash-attn --cache-type-k q4_0 --cache-type-v q4_0 \
          --host 0.0.0.0 --port ${PORT} --threads -1 --mlock"
        gpu_mode: "dual"
        health_check_path: "/health"
        timeout: 720s

      # Extended context dual-GPU
      qwen3-coder-ud-q4-160k-dual:
        cmd: "/app/llama-server \
          -m /models/Qwen3-Coder-30B-A3B-Instruct-UD-Q4_K_XL.gguf \
          -c 163840 -ngl 99 --split-mode layer --tensor-split 1,1 \
          --rope-scaling yarn --rope-scale 5 \
          --flash-attn --cache-type-k q4_0 --cache-type-v q4_0 \
          --host 0.0.0.0 --port ${PORT} --threads -1 --mlock"
        gpu_mode: "dual"
        health_check_path: "/health"
        timeout: 900s

      # High quality dual-GPU
      qwen3-coder-ud-q8-64k-dual:
        cmd: "/app/llama-server \
          -m /models/Qwen3-Coder-30B-A3B-Instruct-UD-Q8_K_XL.gguf \
          -c 65536 -ngl 99 --split-mode layer --tensor-split 1,1 \
          --flash-attn --cache-type-k f16 --cache-type-v f16 \
          --host 0.0.0.0 --port ${PORT} --threads -1 --mlock"
        gpu_mode: "dual"
        health_check_path: "/health"
        timeout: 720s

      # Single GPU fallback (smaller VRAM footprint)
      qwen3-coder-ud-q4-64k-single:
        cmd: "/app/llama-server \
          -m /models/Qwen3-Coder-30B-A3B-Instruct-UD-Q4_K_XL.gguf \
          -c 65536 -ngl 99 --split-mode layer --tensor-split 1,0 \
          --rope-scaling linear --rope-scale 2 \
          --flash-attn --cache-type-k q4_0 --cache-type-v q4_0 \
          --host 0.0.0.0 --port ${PORT} --threads -1 --mlock"
        gpu_mode: "single"
        health_check_path: "/health"
        timeout: 600s

    # Global defaults
    default_model: "qwen3-coder-ud-q4-128k-dual"
    health_check_interval: "30s"
    swap_timeout: "180s"
    cleanup_timeout: "90s"

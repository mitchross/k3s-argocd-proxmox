apiVersion: batch/v1
kind: Job
metadata:
  name: es-connect-test
  namespace: tubearchivist
spec:
  backoffLimit: 0
  template:
    spec:
      restartPolicy: Never
      securityContext:
        runAsNonRoot: true
        runAsUser: 1000
        seccompProfile:
          type: RuntimeDefault
      containers:
      - name: es-test
        image: curlimages/curl:8.2.1
        command: [ "sh", "-c" ]
        args:
        - |
          echo "Attempting to connect to Elasticsearch with authentication...";
          curl -sS -f -u elastic:verysecret http://archivist-es:9200/_cluster/health && echo "\n\nSUCCESS: Successfully connected to Elasticsearch." || echo "\n\nFAILURE: Could not connect to Elasticsearch.";
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
      dnsPolicy: ClusterFirst